<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>demo</title>
    <!-- <link rel="stylesheet" href="https://js.arcgis.com/4.18/esri/themes/light/main.css" /> -->
    <link rel="stylesheet" href="./assets/lib/gis/esri/css/main.css" />

    <style>
        html,
        body,
        #map {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        .esri-layer-list {
            width: 310px;
        }
    </style>

    <!-- <script src="https://js.arcgis.com/4.18/"></script> -->
    <script src="./assets/lib/layui/layui.js"></script>
    <script src="./assets/lib/gis/init.js"></script>
    <script>
        layui.use(function () {

            var $ = layui.$;


            var map, view, zoom = 7;
            require([
                "esri/Map",
                "esri/views/MapView",
                "esri/layers/WMTSLayer",
                "esri/widgets/LayerList",
                "esri/geometry/Point",
                "esri/Color",
                "esri/Graphic",
                "esri/layers/GraphicsLayer",
                "esri/symbols/PictureMarkerSymbol"
            ], function (Map, MapView, WMTSLayer, LayerList, Point, Color, graphic, GraphicsLayer, picSymbol) {
                layer = new WMTSLayer({
                    url: "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best",
                    copyright:
                        "<a target='_top' href='https://earthdata.nasa.gov'>Earthdata</a> by <a target='_top' href='https://www.nasa.gov'>NASA</a>",
                    activeLayer: {
                        id: "SRTM_Color_Index"
                    }
                });
                map = new Map({
                    layers: [layer]
                });
                view = new MapView({
                    container: "map",
                    map: map,
                    center: [16.463814503649008, 48.13488142774444],
                    scale: 144201449.5083617
                });
                var token = "eyJhbGciOiJIUzUxMiIsImlhdCI6MTYzMTIzNjY1NSwiZXhwIjoxNjMxODQxNDU1fQ.eyJpZCI6MSwibGltaXQiOjEsInVzZXIiOiJhZG1pbiIsInN0YXRpb24iOjEyODEsInN0YXRpb25SYW5nZSI6IjEsMTAsMTEsMTMsMTQsMTIsMiwzLDQsNiw3LDg4LDUiLCJtYWluSWQiOjEsIm9mQXJlYSI6IiIsIm9mQ2VudGVyIjoiIn0.Qqu1fn_MovARO5lbRGRnsaYJKUZIh_NlNCOvymAcdLQfx-_h9H5ljTwsKvBDF_z_F-pDzw3G0FEBtfm6_6_U5A";


                $.ajax({
                    url: "http://192.168.1.156:8004/home/index/",
                    data: {
                        type: 2,
                        num: 2
                    },
                    headers: {
                        'token': token
                    },
                    success: function (res) {
                        setLineFn(res.line);
                        setDataFn(res.data);
                    }
                });

                // 添加站点
                function setDataFn(arr) {
                    for (var i = 0; i < arr.length; i++) {
                        var dataItem = arr[i];
                        var log = dataItem.from[0], lat = dataItem.from[1];
                        var point = new Point(log, lat);
                        var size = dataItem.size;
                        if (size == 2) {
                            var area = zoom * 2 >= 14 ? 14 : zoom * 2 <= 6 ? 6 : zoom * 2;
                        } else {
                            var area = zoom * 1.5 >= 14 ? 14 : zoom * 1.5 <= 6 ? 6 : zoom * 1.5;
                        };
                        var picUrl = "./static/icon" + dataItem.type + dataItem.val + ".png";
                        var pic = new picSymbol({
                            url: picUrl,
                            width: area,
                            height: area,
                            item: dataItem
                        });
                        var gp = new graphic(point, pic);
                        view.graphics.add(gp);
                    }
                };

                // 添加线
                function setLineFn(arr) {
                    for (var i = 0; i < arr.length; i++) {
                        var dataItem = arr[i];

                        var color = dataItem.line == 0 ? [51, 204, 0] : [255, 0, 0];
                        var polyline = {
                            type: "polyline",
                            paths: dataItem.coords
                        };
                        var lineSymbol = {
                            type: "simple-line",
                            color: color,
                            width: 1
                        };

                        var polylineGraphic = new graphic({
                            geometry: polyline,
                            symbol: lineSymbol
                        });
                        view.graphics.addMany([polylineGraphic]);
                    };
                };
            });
        });

    </script>
</head>

<body>
    <div id="map"></div>
</body>

</html>